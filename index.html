<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Vendas Brisanet</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/7086/7086783.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 140, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 107, 0, 0.08) 0%, transparent 50%);
            z-index: 0;
            pointer-events: none;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(255, 107, 0, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(255, 107, 0, 0.03) 1px, transparent 1px);
            background-size: 100px 100px;
            z-index: 0;
            pointer-events: none;
            opacity: 0.3;
        }
        
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(255, 107, 0, 0.4);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            animation: float 20s infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(100vw, -100vh) scale(0); opacity: 0; }
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }
        
        .hero-section {
            text-align: center;
            padding: 120px 20px 80px;
            position: relative;
            z-index: 1;
        }
        
        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 107, 0, 0.1);
            border: 1px solid rgba(255, 107, 0, 0.3);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            color: #ff6b00;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .hero-title {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #ff6b00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 24px;
            line-height: 1.1;
            letter-spacing: -2px;
        }
        
        .hero-subtitle {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
            max-width: 700px;
            margin: 0 auto 50px;
            font-weight: 400;
        }
        
        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            color: white;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .hero-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .hero-cta:hover::before {
            left: 100%;
        }
        
        .hero-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(255, 107, 0, 0.5);
        }
        
        .card { 
            background: rgba(20, 20, 20, 0.8);
            border-radius: 24px; 
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 107, 0, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card:hover {
            border-color: rgba(255, 107, 0, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(255, 107, 0, 0.15);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1, h2, h3 { 
            color: #fff;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        h1 { font-size: 36px; margin-bottom: 24px; }
        h2 { font-size: 28px; margin-bottom: 20px; }
        h3 { font-size: 20px; margin-bottom: 16px; }
        
        input, select, button { 
            width: 100%; 
            padding: 16px 20px;
            margin: 12px 0;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }
        
        input, select { 
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            backdrop-filter: blur(10px);
        }
        
        input:focus, select:focus { 
            outline: none; 
            border-color: #ff6b00;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        button { 
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            color: #fff; 
            font-weight: 600;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.4);
        }
        
        button:active { 
            transform: translateY(0);
        }
        
        button:disabled { 
            background: rgba(100, 100, 100, 0.3);
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary { 
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: #ff6b00;
        }
        
        .grid { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .stat-card { 
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.15) 0%, rgba(255, 140, 0, 0.05) 100%);
            border: 1px solid rgba(255, 107, 0, 0.3);
            padding: 32px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(20px);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 0, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 107, 0, 0.6);
            box-shadow: 0 20px 50px rgba(255, 107, 0, 0.2);
        }
        
        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 14px;
            margin-bottom: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }
        
        .stat-value { 
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #ff6b00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 16px 0;
            position: relative;
            z-index: 1;
        }
        
        .service-stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 32px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            transition: all 0.3s;
        }
        
        .service-stat-card:hover {
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 0, 0.15);
        }
        
        .service-stat-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .service-icon-wrapper {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2) 0%, rgba(255, 140, 0, 0.1) 100%);
            padding: 14px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .service-stat-value {
            font-size: 42px;
            font-weight: 800;
            color: #ff6b00;
            margin: 16px 0;
        }
        
        .service-stat-label {
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            font-weight: 500;
        }
        
        .period-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            width: auto;
            font-size: 14px;
        }
        
        .period-btn:hover {
            border-color: rgba(255, 107, 0, 0.5);
            background: rgba(255, 107, 0, 0.1);
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            border-color: #ff6b00;
            box-shadow: 0 5px 20px rgba(255, 107, 0, 0.3);
        }
        
        .date-range-selector {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 24px;
            padding: 32px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 107, 0, 0.2);
        }
        
        .date-input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 220px;
        }
        
        .date-input-label {
            color: #ff6b00;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            text-align: center;
        }
        
        .date-button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 16px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            min-width: 220px;
            position: relative;
            overflow: hidden;
        }
        
        .date-button:hover {
            border-color: #ff6b00;
            background: rgba(255, 107, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .date-button .date-icon {
            color: #ff6b00;
            pointer-events: none;
            position: relative;
            z-index: 1;
        }
        
        .date-button input[type="date"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            left: 0;
            top: 0;
            z-index: 100;
        }
        
        .date-button span {
            pointer-events: none;
            position: relative;
            z-index: 1;
        }
        
        .btn-apply {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            color: #fff;
            border: none;
            padding: 14px 36px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
            width: auto;
        }
        
        .btn-apply:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 107, 0, 0.5);
        }
        
        .sale-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .sale-type-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 28px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .sale-type-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }
        
        .sale-type-card:hover::before {
            opacity: 1;
        }
        
        .sale-type-card:hover {
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 107, 0, 0.2);
        }
        
        .sale-type-card.active {
            border-color: #ff6b00;
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.15) 0%, rgba(255, 107, 0, 0.05) 100%);
            box-shadow: 0 0 30px rgba(255, 107, 0, 0.3);
            transform: scale(1.03);
        }
        
        .sale-type-card.active::after {
            content: '‚úì';
            position: absolute;
            top: 16px;
            right: 16px;
            background: #ff6b00;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.4);
        }
        
        .sale-type-card h3 {
            color: #fff;
            margin: 16px 0 8px 0;
            font-size: 18px;
            position: relative;
            z-index: 1;
        }
        
        .sale-type-card.active h3 {
            color: #ff6b00;
        }
        
        .sale-type-card p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            position: relative;
            z-index: 1;
        }
        
        .sale-type-card.active p {
            color: rgba(255, 107, 0, 0.8);
        }
        
        .plan-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .plan-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 24px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }
        
        .plan-card:hover {
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.15);
        }
        
        .plan-card.active {
            border-color: #ff6b00;
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.15) 0%, rgba(255, 107, 0, 0.05) 100%);
            box-shadow: 0 0 25px rgba(255, 107, 0, 0.3);
        }
        
        .plan-card.active::before {
            content: '‚úì';
            position: absolute;
            top: 12px;
            right: 12px;
            background: #ff6b00;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .plan-gb {
            font-size: 28px;
            font-weight: 800;
            color: #ff6b00;
            margin-bottom: 8px;
        }
        
        .plan-price {
            font-size: 16px;
            color: #fff;
            font-weight: 600;
        }
        
        .date-group {
            margin-bottom: 28px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
        }
        
        .date-group-header {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.15) 0%, rgba(255, 140, 0, 0.05) 100%);
            padding: 20px 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            user-select: none;
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }
        
        .date-group-header:hover {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2) 0%, rgba(255, 140, 0, 0.1) 100%);
        }
        
        .date-group-title {
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 17px;
            font-weight: 700;
            color: #fff;
        }
        
        .date-group-count {
            background: rgba(255, 107, 0, 0.3);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            color: #fff;
        }
        
        .date-group-toggle {
            font-size: 22px;
            transition: transform 0.3s;
            color: #ff6b00;
        }
        
        .date-group-toggle.collapsed {
            transform: rotate(-90deg);
        }
        
        .date-group-content {
            max-height: 3000px;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s;
            opacity: 1;
        }
        
        .date-group-content.collapsed {
            max-height: 0;
            opacity: 0;
        }
        
        table { 
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        
        th, td { 
            padding: 18px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        th { 
            color: #ff6b00;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            background: rgba(255, 255, 255, 0.02);
        }
        
        td { 
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        tr:hover {
            background: rgba(255, 107, 0, 0.05);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-efetivado {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .status-pendente {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .icon { width: 20px; height: 20px; stroke: currentColor; flex-shrink: 0; }
        .icon-lg { width: 24px; height: 24px; }
        .icon-xl { width: 32px; height: 32px; }
        
        .form-group { margin-bottom: 20px; }
        
        .form-label { 
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .text-center { text-align: center; }
        .link { 
            color: #ff6b00;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        .link:hover { 
            text-decoration: underline;
            color: #ff8c00;
        }
        
        .flex-between { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .section-header { 
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 24px;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: rgba(255, 255, 255, 0.4);
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            width: auto;
            padding: 10px 18px;
            font-size: 13px;
        }
        
        .footer-credits {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 14px;
            margin-top: 60px;
            position: relative;
            z-index: 1;
        }
        
        .footer-credits strong {
            color: #ff6b00;
            font-weight: 700;
        }
        
        @media (max-width: 768px) {
            .hero-title { font-size: 42px; }
            .hero-subtitle { font-size: 18px; }
            .container { padding: 20px 15px; }
            .card { padding: 24px; }
            .grid { grid-template-columns: 1fr; }
            .stat-value { font-size: 36px; }
            .service-stat-value { font-size: 32px; }
            h1 { font-size: 28px; }
            h2 { font-size: 22px; }
            .sale-type-selector { grid-template-columns: 1fr; }
            .plan-selector { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
            .date-range-selector { padding: 24px; }
            .date-input-group { min-width: 100%; }
            .date-button { min-width: 100%; }
            .btn-apply { width: 100%; }
            table { font-size: 13px; }
            th, td { padding: 12px 10px; }
        }
        
        @media (max-width: 480px) {
            .hero-title { font-size: 32px; }
            .hero-subtitle { font-size: 16px; }
            table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 30%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 6s;"></div>
    <div class="particle" style="left: 70%; animation-delay: 9s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 12s;"></div>
    
    <div id="app"></div>

    <script>
        const SUPABASE_URL = 'https://uijtwnzfhkgzxmdtrxjm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVpanR3bnpmaGtnenhtZHRyeGptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMTY5NzksImV4cCI6MjA3NTc5Mjk3OX0.pM9RF3LKPzWpBqiXi75Mj9wQiRw4ysbaItfFPEdq6fE';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentPage = 'login';
        let currentUser = null;
        let selectedSaleType = '';
        let selectedPeriod = 'monthly';
        let customStartDate = '';
        let customEndDate = '';
        let selectedPlan = '';
        let collapsedDates = new Set();

        const icons = {
            user: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
            userLg: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
            lockLg: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>',
            dashboard: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>',
            chart: '<svg class="icon-xl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',
            package: '<svg class="icon-xl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',
            shoppingCart: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>',
            list: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>',
            logout: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>',
            check: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>',
            wifi: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>',
            smartphone: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>',
            layers: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>',
            inbox: '<svg class="icon-xl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg>',
            calendar: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
            barChart: '<svg class="icon-xl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>',
            zap: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',
            trendingUp: '<svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>',
            arrowRight: '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>'
        };

        async function register(fullName, email, phone, password) {
            try {
                const result = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName,
                            phone: phone
                        }
                    }
                });
                
                if (result.error) throw result.error;
                
                if (result.data.user) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    const { error: insertError } = await supabase.from('users').insert([{
                        id: result.data.user.id,
                        full_name: fullName,
                        email: email,
                        phone: phone,
                        password: password,
                        created_at: new Date().toISOString()
                    }]);
                    
                    if (insertError) {
                        console.error('Erro ao inserir na tabela users:', insertError);
                    }

                    try {
                        const webhookData = {
                            full_name: fullName,
                            email: email,
                            phone: phone,
                            user_id: result.data.user.id,
                            created_at: new Date().toISOString(),
                            event: 'user_registered'
                        };
                        
                        await fetch('https://n8n-n8n.rthuab.easypanel.host/webhook/fluxo', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify(webhookData)
                        });
                    } catch (webhookError) {
                        console.error('Erro ao enviar webhook:', webhookError);
                    }
                }
                
                alert('Cadastro realizado com sucesso! Fa√ßa login para continuar.');
                return true;
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar: ' + error.message);
                return false;
            }
        }

        async function login(email, password) {
            try {
                const result = await supabase.auth.signInWithPassword({ email, password });
                if (result.error) throw result.error;
                
                const { data: userData, error: userError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', result.data.user.id)
                    .single();
                
                if (userError || !userData) {
                    const { error: insertError } = await supabase.from('users').insert([{
                        id: result.data.user.id,
                        full_name: result.data.user.user_metadata?.full_name || '',
                        email: result.data.user.email,
                        phone: result.data.user.user_metadata?.phone || '',
                        password: ''
                    }]);
                    
                    if (insertError) {
                        console.error('Erro ao criar usu√°rio na tabela:', insertError);
                    }
                }
                
                currentUser = result.data.user;
                return true;
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao fazer login: ' + error.message);
                return false;
            }
        }

        async function logout() {
            await supabase.auth.signOut();
            currentUser = null;
        }

        async function addSale(saleType, customerCPF, quantity, iccid, status, plan, customPlan) {
            try {
                try {
                    await supabase.from('users').upsert([{
                        id: currentUser.id,
                        full_name: currentUser.user_metadata?.full_name || currentUser.email.split('@')[0],
                        email: currentUser.email,
                        phone: currentUser.user_metadata?.phone || '',
                        password: ''
                    }], { onConflict: 'id' });
                } catch (upsertError) {
                    console.log('Usu√°rio j√° existe ou erro ao criar:', upsertError);
                }
                
                const finalStatus = saleType === 'BrisaChip' ? 'Efetivado' : (status || 'Pendente');
                
                const saleData = {
                    user_id: currentUser.id,
                    service_type: saleType,
                    customer_cpf: customerCPF || 'N√£o informado',
                    quantity: parseInt(quantity),
                    iccid: iccid || null,
                    status: finalStatus,
                    created_at: new Date().toISOString()
                };
                
                if (plan) {
                    saleData.plan = plan;
                } else if (customPlan) {
                    saleData.plan = customPlan;
                }
                
                const result = await supabase.from('sales').insert([saleData]);
                
                if (result.error) throw result.error;
                return true;
            } catch (error) {
                console.error('Erro completo:', error);
                alert('Erro ao registrar venda: ' + error.message);
                return false;
            }
        }

        async function deleteSale(saleId) {
            try {
                const result = await supabase.from('sales').delete().eq('id', saleId).eq('user_id', currentUser.id);
                if (result.error) throw result.error;
                return true;
            } catch (error) {
                console.error('Erro:', error);
                return false;
            }
        }

        async function getSales() {
            try {
                const result = await supabase.from('sales').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
                return result.error ? [] : result.data;
            } catch (error) {
                return [];
            }
        }

        function filterSalesByPeriod(sales, period) {
            const now = new Date();
            return sales.filter(sale => {
                const saleDate = new Date(sale.created_at);
                
                if (period === 'daily') {
                    return saleDate.toDateString() === now.toDateString();
                } else if (period === 'weekly') {
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return saleDate >= weekAgo;
                } else if (period === 'monthly') {
                    const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                    firstDay.setHours(0, 0, 0, 0);
                    const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    lastDay.setHours(23, 59, 59, 999);
                    return saleDate >= firstDay && saleDate <= lastDay;
                } else if (period === 'custom') {
                    if (!customStartDate || !customEndDate) return true;
                    const startDate = new Date(customStartDate);
                    startDate.setHours(0, 0, 0, 0);
                    const endDate = new Date(customEndDate);
                    endDate.setHours(23, 59, 59, 999);
                    return saleDate >= startDate && saleDate <= endDate;
                }
                return true;
            });
        }

        function formatDateBR(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatFullDateBR(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString + 'T00:00:00');
            const weekdays = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            const weekday = weekdays[date.getDay()];
            const day = date.getDate();
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            
            return `${weekday}, ${day} de ${month} de ${year}`;
        }

        function groupSalesByDate(sales) {
            const grouped = {};
            
            sales.forEach(sale => {
                const date = new Date(sale.created_at);
                const dateKey = date.toISOString().split('T')[0];
                
                if (!grouped[dateKey]) {
                    grouped[dateKey] = [];
                }
                grouped[dateKey].push(sale);
            });
            
            return grouped;
        }

        function toggleDateGroup(dateKey) {
            if (collapsedDates.has(dateKey)) {
                collapsedDates.delete(dateKey);
            } else {
                collapsedDates.add(dateKey);
            }
            
            const content = document.getElementById(`date-content-${dateKey}`);
            const toggle = document.getElementById(`date-toggle-${dateKey}`);
            
            if (content && toggle) {
                content.classList.toggle('collapsed');
                toggle.classList.toggle('collapsed');
            }
        }

        function renderRegisterPage() {
            return `
                <div class="hero-section">
                    <div class="hero-badge">
                        ${icons.zap}
                        <span>Sistema Profissional de Vendas</span>
                    </div>
                    <h1 class="hero-title">Registro de Vendas<br>Brisanet</h1>
                    <p class="hero-subtitle">Gerencie suas vendas de forma profissional e eficiente</p>
                </div>
                
                <div class="container">
                    <div style="max-width: 500px; margin: 0 auto;">
                        <div class="card glass-card">
                            <div class="section-header" style="justify-content: center;">
                                ${icons.userLg}
                                <h2>Criar Conta</h2>
                            </div>
                            <input type="text" id="fullName" placeholder="Nome Completo" required>
                            <input type="email" id="email" placeholder="Email" required>
                            <div class="form-group">
                                <label class="form-label">üì± Telefone (WhatsApp) - C√≥digo do pa√≠s obrigat√≥rio</label>
                                <input type="tel" id="phone" placeholder="Ex: 55 85 98765-4321" value="55 " required style="margin: 0;">
                            </div>
                            <input type="password" id="password" placeholder="Senha (m√≠nimo 6 caracteres)" required>
                            <button id="btnRegister" onclick="handleRegister()">
                                ${icons.check}
                                <span>Cadastrar</span>
                            </button>
                            <button onclick="changePage('login')" class="btn-outline">
                                ${icons.arrowRight}
                                <span>J√° tenho conta</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="footer-credits">
                    Desenvolvido por <strong>Igor Borges</strong> ‚Ä¢ Sistema Profissional de Gest√£o
                </div>
            `;
        }

        function renderLoginPage() {
            return `
                <div class="hero-section">
                    <div class="hero-badge">
                        ${icons.trendingUp}
                        <span>Bem-vindo de volta</span>
                    </div>
                    <h1 class="hero-title">Acesse sua conta</h1>
                    <p class="hero-subtitle">Entre agora e gerencie suas vendas</p>
                </div>
                
                <div class="container">
                    <div style="max-width: 500px; margin: 0 auto;">
                        <div class="card glass-card">
                            <div class="section-header" style="justify-content: center;">
                                ${icons.lockLg}
                                <h2>Login</h2>
                            </div>
                            <input type="email" id="loginEmail" placeholder="Email">
                            <input type="password" id="loginPassword" placeholder="Senha">
                            <button id="btnLogin" onclick="handleLogin()">
                                ${icons.check}
                                <span>Entrar</span>
                            </button>
                            <button onclick="changePage('register')" class="btn-outline">
                                ${icons.userLg}
                                <span>Criar Conta</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="footer-credits">
                    Desenvolvido por <strong>Igor Borges</strong> ‚Ä¢ Sistema Profissional de Gest√£o
                </div>
            `;
        }

        async function renderDashboard() {
            const allSales = await getSales();
            const sales = filterSalesByPeriod(allSales, selectedPeriod);
            
            const efetivadosSales = sales.filter(s => s.status === 'Efetivado');
            const totalSales = efetivadosSales.length;
            const efetivados = efetivadosSales.length;
            const pendentes = sales.filter(s => s.status === 'Pendente').length;
            
            const comboSales = efetivadosSales.filter(s => s.service_type === 'Combo').length;
            const chipSales = efetivadosSales.filter(s => s.service_type === 'BrisaChip').length;
            const fibraSales = efetivadosSales.filter(s => s.service_type === 'Fibra').length;
            
            const now = new Date();
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const currentMonth = monthNames[now.getMonth()];
            const currentYear = now.getFullYear();
            
            let periodText = '';
            if (selectedPeriod === 'daily') periodText = 'Hoje';
            else if (selectedPeriod === 'weekly') periodText = 'Esta Semana';
            else if (selectedPeriod === 'monthly') periodText = `${currentMonth} de ${currentYear}`;
            else if (selectedPeriod === 'custom') {
                periodText = (customStartDate && customEndDate) 
                    ? formatDateBR(customStartDate) + ' at√© ' + formatDateBR(customEndDate)
                    : 'Per√≠odo Personalizado';
            }

            const salesByDate = groupSalesByDate(sales);
            const sortedDates = Object.keys(salesByDate).sort((a, b) => new Date(b) - new Date(a));

            return `
                <div class="container">
                    <div class="card" style="margin-top: 40px;">
                        <div class="flex-between">
                            <div class="section-header" style="margin: 0;">
                                ${icons.dashboard}
                                <div>
                                    <h1 style="margin: 0;">Dashboard de Vendas</h1>
                                    <p style="color: rgba(255, 255, 255, 0.5); margin-top: 8px; font-size: 15px;">Bem-vindo, ${currentUser.user_metadata?.full_name || currentUser.email}</p>
                                </div>
                            </div>
                            <button class="btn-secondary" onclick="handleLogout()" style="width: auto; padding: 14px 28px;">
                                ${icons.logout}
                                <span>Sair</span>
                            </button>
                        </div>
                    </div>

                    <div class="card glass-card">
                        <h2 style="text-align: center; margin-bottom: 20px;">Per√≠odo: ${periodText}</h2>
                        <div class="period-selector">
                            <button class="period-btn ${selectedPeriod === 'daily' ? 'active' : ''}" onclick="changePeriod('daily')">Di√°rio</button>
                            <button class="period-btn ${selectedPeriod === 'weekly' ? 'active' : ''}" onclick="changePeriod('weekly')">Semanal</button>
                            <button class="period-btn ${selectedPeriod === 'monthly' ? 'active' : ''}" onclick="changePeriod('monthly')">Mensal</button>
                            <button class="period-btn ${selectedPeriod === 'custom' ? 'active' : ''}" onclick="changePeriod('custom')">Personalizado</button>
                        </div>
                        ${selectedPeriod === 'custom' ? `
                            <div class="date-range-selector">
                                <div class="date-input-group">
                                    <div class="date-input-label">${icons.calendar} Data Inicial</div>
                                    <button class="date-button">
                                        <div class="date-icon">${icons.calendar}</div>
                                        <span id="startDateText">${customStartDate ? formatDateBR(customStartDate) : 'Selecionar Data'}</span>
                                        <input type="date" id="startDate" value="${customStartDate}" onchange="updateCustomDate('start')">
                                    </button>
                                </div>
                                
                                <div class="date-input-group">
                                    <div class="date-input-label">${icons.calendar} Data Final</div>
                                    <button class="date-button">
                                        <div class="date-icon">${icons.calendar}</div>
                                        <span id="endDateText">${customEndDate ? formatDateBR(customEndDate) : 'Selecionar Data'}</span>
                                        <input type="date" id="endDate" value="${customEndDate}" onchange="updateCustomDate('end')">
                                    </button>
                                </div>
                                
                                <button onclick="applyCustomPeriod()" class="btn-apply" style="margin-top: 24px;">
                                    ${icons.check}
                                    <span>Aplicar Per√≠odo</span>
                                </button>
                            </div>
                        ` : ''}
                    </div>

                    <div class="grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                ${icons.chart}
                                <span>Total de Vendas</span>
                            </div>
                            <div class="stat-value">${totalSales}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                ${icons.check}
                                <span>Efetivados</span>
                            </div>
                            <div class="stat-value">${efetivados}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                ${icons.package}
                                <span>Pendentes</span>
                            </div>
                            <div class="stat-value">${pendentes}</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            ${icons.layers}
                            <h2 style="margin: 0;">Vendas por Tipo de Servi√ßo</h2>
                        </div>
                        <div class="grid">
                            <div class="service-stat-card">
                                <div class="service-stat-header">
                                    <div class="service-icon-wrapper">${icons.layers}</div>
                                    <span style="color: rgba(255, 255, 255, 0.8); font-size: 15px; font-weight: 600;">Combo Completo</span>
                                </div>
                                <div class="service-stat-value">${comboSales}</div>
                                <div class="service-stat-label">vendas realizadas</div>
                            </div>
                            <div class="service-stat-card">
                                <div class="service-stat-header">
                                    <div class="service-icon-wrapper">${icons.smartphone}</div>
                                    <span style="color: rgba(255, 255, 255, 0.8); font-size: 15px; font-weight: 600;">BrisaChip</span>
                                </div>
                                <div class="service-stat-value">${chipSales}</div>
                                <div class="service-stat-label">chips vendidos</div>
                            </div>
                            <div class="service-stat-card">
                                <div class="service-stat-header">
                                    <div class="service-icon-wrapper">${icons.wifi}</div>
                                    <span style="color: rgba(255, 255, 255, 0.8); font-size: 15px; font-weight: 600;">Fibra √ìptica</span>
                                </div>
                                <div class="service-stat-value">${fibraSales}</div>
                                <div class="service-stat-label">fibras instaladas</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            ${icons.shoppingCart}
                            <h2 style="margin: 0;">Registrar Nova Venda</h2>
                        </div>
                        
                        <div class="sale-type-selector">
                            <div class="sale-type-card ${selectedSaleType === 'Combo' ? 'active' : ''}" onclick="selectSaleType('Combo')">
                                ${icons.layers}
                                <h3>Internet Fibra + BrisaChip</h3>
                                <p>Combo completo</p>
                            </div>
                            <div class="sale-type-card ${selectedSaleType === 'BrisaChip' ? 'active' : ''}" onclick="selectSaleType('BrisaChip')">
                                ${icons.smartphone}
                                <h3>BrisaChip</h3>
                                <p>Chip avulso</p>
                            </div>
                            <div class="sale-type-card ${selectedSaleType === 'Fibra' ? 'active' : ''}" onclick="selectSaleType('Fibra')">
                                ${icons.wifi}
                                <h3>Fibra √ìptica</h3>
                                <p>Internet avulsa</p>
                            </div>
                        </div>

                        <div id="saleForm"></div>
                    </div>

                    <div class="card">
                        <div class="section-header">
                            ${icons.list}
                            <h2 style="margin: 0;">Hist√≥rico de Vendas (${periodText})</h2>
                        </div>
                        ${sales.length > 0 ? `
                            <div>
                                ${sortedDates.map(dateKey => {
                                    const dateSales = salesByDate[dateKey];
                                    const isCollapsed = collapsedDates.has(dateKey);
                                    
                                    return `
                                        <div class="date-group">
                                            <div class="date-group-header" onclick="toggleDateGroup('${dateKey}')">
                                                <div class="date-group-title">
                                                    ${icons.calendar}
                                                    <span>${formatFullDateBR(dateKey)}</span>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 15px;">
                                                    <div class="date-group-count">${dateSales.length} ${dateSales.length === 1 ? 'venda' : 'vendas'}</div>
                                                    <div id="date-toggle-${dateKey}" class="date-group-toggle ${isCollapsed ? 'collapsed' : ''}">‚ñº</div>
                                                </div>
                                            </div>
                                            <div id="date-content-${dateKey}" class="date-group-content ${isCollapsed ? 'collapsed' : ''}">
                                                <div style="overflow-x: auto;">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Tipo</th>
                                                                <th>CPF</th>
                                                                <th>Qtd</th>
                                                                <th>ICCID</th>
                                                                <th>Plano</th>
                                                                <th>Status</th>
                                                                <th>Hora</th>
                                                                <th>A√ß√µes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${dateSales.map(sale => {
                                                                const saleTime = new Date(sale.created_at).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                                                                return `
                                                                    <tr>
                                                                        <td>${sale.service_type}</td>
                                                                        <td>${sale.customer_cpf}</td>
                                                                        <td>${sale.quantity}</td>
                                                                        <td>${sale.iccid || '-'}</td>
                                                                        <td>${sale.plan || '-'}</td>
                                                                        <td>
                                                                            <span class="status-badge status-${sale.status.toLowerCase()}">
                                                                                ${sale.status}
                                                                            </span>
                                                                        </td>
                                                                        <td>${saleTime}</td>
                                                                        <td style="display: flex; gap: 8px; flex-wrap: wrap;">
                                                                            ${sale.service_type !== 'BrisaChip' ? (
                                                                                sale.status === 'Pendente' 
                                                                                ? `<button onclick="toggleStatus('${sale.id}', 'Efetivado')" style="width: auto; padding: 10px 18px; font-size: 13px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); white-space: nowrap;">‚úì Efetivar</button>`
                                                                                : `<button onclick="toggleStatus('${sale.id}', 'Pendente')" style="width: auto; padding: 10px 18px; font-size: 13px; background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%); color: #000; white-space: nowrap;">‚Ü∂ Pendente</button>`
                                                                            ) : '<span style="color: #28a745; font-size: 13px; font-weight: 600;">‚úì Auto-efetivado</span>'}
                                                                            <button onclick="handleDeleteSale('${sale.id}')" class="btn-delete" style="white-space: nowrap;">üóë Excluir</button>
                                                                        </td>
                                                                    </tr>
                                                                `;
                                                            }).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                ${icons.inbox}
                                <p style="font-size: 16px; margin-top: 16px;">Nenhuma venda registrada neste per√≠odo</p>
                            </div>
                        `}
                    </div>
                    
                    <div class="footer-credits">
                        Desenvolvido por <strong>Igor Borges</strong> ‚Ä¢ Sistema Profissional de Gest√£o
                    </div>
                </div>
            `;
        }

        function selectSaleType(type) {
            selectedSaleType = type;
            selectedPlan = '';
            
            const cards = document.querySelectorAll('.sale-type-card');
            cards.forEach(card => card.classList.remove('active'));
            
            event.target.closest('.sale-type-card').classList.add('active');
            
            renderSaleForm();
        }

        function selectPlan(plan) {
            selectedPlan = plan;
            
            const planCards = document.querySelectorAll('.plan-card');
            planCards.forEach(card => card.classList.remove('active'));
            
            if (event && event.target) {
                const clickedCard = event.target.closest('.plan-card');
                if (clickedCard) {
                    clickedCard.classList.add('active');
                }
            }
        }

        function renderSaleForm() {
            const formContainer = document.getElementById('saleForm');
            if (!formContainer) return;

            let formHTML = '';

            if (selectedSaleType === 'Combo') {
                formHTML = `
                    <div class="form-group">
                        <label class="form-label">Plano (Opcional)</label>
                        <input type="text" id="customPlan" placeholder="Ex: 500MB + Brisachip">
                        <small style="color: rgba(255, 255, 255, 0.4); font-size: 12px; display: block; margin-top: 5px;">üí° Exemplo: 500MB + Brisachip</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF do Cliente (Opcional)</label>
                        <input type="text" id="customerCPF" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantidade</label>
                        <input type="number" id="quantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="status">
                            <option value="Pendente">Pendente</option>
                            <option value="Efetivado">Efetivado</option>
                        </select>
                    </div>
                    <button onclick="handleAddSale()">
                        ${icons.check}
                        <span>Registrar Venda</span>
                    </button>
                `;
            } else if (selectedSaleType === 'BrisaChip') {
                formHTML = `
                    <div class="form-label" style="margin-bottom: 16px;">Selecione o Plano:</div>
                    <div class="plan-selector">
                        <div class="plan-card ${selectedPlan === '20GB - R$ 29,99' ? 'active' : ''}" onclick="selectPlan('20GB - R$ 29,99')">
                            <div class="plan-gb">20GB</div>
                            <div class="plan-price">R$ 29,99</div>
                        </div>
                        <div class="plan-card ${selectedPlan === '30GB - R$ 39,99' ? 'active' : ''}" onclick="selectPlan('30GB - R$ 39,99')">
                            <div class="plan-gb">30GB</div>
                            <div class="plan-price">R$ 39,99</div>
                        </div>
                        <div class="plan-card ${selectedPlan === '100GB - R$ 49,99' ? 'active' : ''}" onclick="selectPlan('100GB - R$ 49,99')">
                            <div class="plan-gb">100GB</div>
                            <div class="plan-price">R$ 49,99</div>
                        </div>
                    </div>
                    ${selectedPlan ? `
                        <div style="background: rgba(255, 107, 0, 0.15); border: 1px solid rgba(255, 107, 0, 0.4); border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center;">
                            <span style="color: #ff6b00; font-weight: 700; font-size: 15px;">‚úì Plano Selecionado: ${selectedPlan}</span>
                        </div>
                    ` : ''}
                    <div class="form-group">
                        <label class="form-label">CPF do Cliente (Opcional)</label>
                        <input type="text" id="customerCPF" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantidade</label>
                        <input type="number" id="quantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ICCID (√öltimos 8 d√≠gitos - Obrigat√≥rio)</label>
                        <input type="text" id="iccid" placeholder="Digite os 8 √∫ltimos d√≠gitos" maxlength="8">
                    </div>
                    <button onclick="handleAddSale()">
                        ${icons.check}
                        <span>Registrar Venda</span>
                    </button>
                `;
            } else if (selectedSaleType === 'Fibra') {
                formHTML = `
                    <div class="form-group">
                        <label class="form-label">Plano (Opcional)</label>
                        <input type="text" id="customPlan" placeholder="Ex: 350MB + Streaming">
                        <small style="color: rgba(255, 255, 255, 0.4); font-size: 12px; display: block; margin-top: 5px;">üí° Exemplo: 350MB + Streaming</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF do Cliente (Opcional)</label>
                        <input type="text" id="customerCPF" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantidade</label>
                        <input type="number" id="quantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="status">
                            <option value="Pendente">Pendente</option>
                            <option value="Efetivado">Efetivado</option>
                        </select>
                    </div>
                    <button onclick="handleAddSale()">
                        ${icons.check}
                        <span>Registrar Venda</span>
                    </button>
                `;
            } else {
                formHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.4); padding: 60px 20px; font-size: 15px;">Selecione um tipo de servi√ßo acima</p>';
            }

            formContainer.innerHTML = formHTML;
        }

        async function handleRegister() {
            const btn = document.getElementById('btnRegister');
            btn.disabled = true;
            btn.innerHTML = icons.check + '<span>Cadastrando...</span>';
            
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            let phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;

            if (!fullName) {
                alert('O campo Nome Completo √© obrigat√≥rio!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            if (!email) {
                alert('O campo Email √© obrigat√≥rio!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Por favor, insira um email v√°lido!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            if (!phone.startsWith('55')) {
                phone = '55 ' + phone;
            }

            if (!phone || phone === '55' || phone === '55 ' || phone.replace(/\D/g, '').length < 12) {
                alert('Por favor, insira um n√∫mero de telefone v√°lido com DDD!\nFormato: 55 85 98765-4321');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            if (!password) {
                alert('O campo Senha √© obrigat√≥rio!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            if (password.length < 6) {
                alert('A senha deve ter no m√≠nimo 6 caracteres!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Cadastrar</span>';
                return;
            }

            const success = await register(fullName, email, phone, password);
            if (success) {
                changePage('login');
            }
            
            btn.disabled = false;
            btn.innerHTML = icons.check + '<span>Cadastrar</span>';
        }

        async function handleLogin() {
            const btn = document.getElementById('btnLogin');
            btn.disabled = true;
            btn.innerHTML = icons.check + '<span>Entrando...</span>';
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Preencha todos os campos!');
                btn.disabled = false;
                btn.innerHTML = icons.check + '<span>Entrar</span>';
                return;
            }

            const success = await login(email, password);
            if (success) {
                await changePage('dashboard');
            }
            
            btn.disabled = false;
            btn.innerHTML = icons.check + '<span>Entrar</span>';
        }

        async function handleLogout() {
            if (confirm('Deseja realmente sair?')) {
                await logout();
                changePage('login');
            }
        }

        async function handleAddSale() {
            const cpfInput = document.getElementById('customerCPF');
            const quantityInput = document.getElementById('quantity');
            const iccidInput = document.getElementById('iccid');
            const statusInput = document.getElementById('status');
            const customPlanInput = document.getElementById('customPlan');
            
            const customerCPF = cpfInput ? cpfInput.value.trim() : '';
            const quantity = quantityInput ? quantityInput.value : '1';
            const iccid = iccidInput ? iccidInput.value.trim() : '';
            const status = statusInput ? statusInput.value : 'Pendente';
            const customPlan = customPlanInput ? customPlanInput.value.trim() : '';

            if (!selectedSaleType) {
                alert('Selecione o tipo de servi√ßo!');
                return;
            }

            if (!quantity) {
                alert('Preencha o campo de quantidade!');
                return;
            }

            if (selectedSaleType === 'BrisaChip') {
                if (!iccid) {
                    alert('O campo ICCID √© obrigat√≥rio para BrisaChip!');
                    return;
                }
                if (iccid.length !== 8) {
                    alert('O ICCID deve ter exatamente 8 d√≠gitos!');
                    return;
                }
                if (!/^\d{8}$/.test(iccid)) {
                    alert('O ICCID deve conter apenas n√∫meros!');
                    return;
                }
                if (!selectedPlan) {
                    alert('Selecione um plano para BrisaChip!');
                    return;
                }
            }

            const success = await addSale(selectedSaleType, customerCPF, quantity, iccid, status, selectedPlan, customPlan);
            if (success) {
                alert('Venda registrada com sucesso!');
                selectedSaleType = '';
                selectedPlan = '';
                await changePage('dashboard');
            }
        }

        async function toggleStatus(saleId, newStatus) {
            if (!saleId) {
                alert('Erro: ID da venda inv√°lido');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('sales')
                    .update({ status: newStatus })
                    .eq('id', saleId)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                alert(`Venda ${newStatus === 'Efetivado' ? 'efetivada' : 'marcada como pendente'} com sucesso!`);
                await changePage('dashboard');
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                alert('Erro ao atualizar status: ' + error.message);
            }
        }

        async function handleDeleteSale(saleId) {
            if (confirm('Tem certeza que deseja excluir esta venda?')) {
                const success = await deleteSale(saleId);
                if (success) {
                    await changePage('dashboard');
                }
            }
        }

        function changePeriod(period) {
            selectedPeriod = period;
            if (period !== 'custom') {
                customStartDate = '';
                customEndDate = '';
            } else if (period === 'custom' && !customStartDate && !customEndDate) {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                customStartDate = `${year}-${month}-${day}`;
                customEndDate = `${year}-${month}-${day}`;
            }
            changePage('dashboard');
        }

        function updateCustomDate(type) {
            const startInput = document.getElementById('startDate');
            const endInput = document.getElementById('endDate');
            const startText = document.getElementById('startDateText');
            const endText = document.getElementById('endDateText');
            
            if (type === 'start' && startInput) {
                customStartDate = startInput.value;
                if (startText && customStartDate) {
                    startText.textContent = formatDateBR(customStartDate);
                }
            } else if (type === 'end' && endInput) {
                customEndDate = endInput.value;
                if (endText && customEndDate) {
                    endText.textContent = formatDateBR(customEndDate);
                }
            }
        }

        function applyCustomPeriod() {
            if (!customStartDate || !customEndDate) {
                alert('Selecione as datas de in√≠cio e fim!');
                return;
            }
            if (new Date(customStartDate) > new Date(customEndDate)) {
                alert('A data inicial n√£o pode ser maior que a data final!');
                return;
            }
            changePage('dashboard');
        }

        async function changePage(page) {
            currentPage = page;
            await render();
        }

        async function render() {
            let html = '';
            
            if (currentPage === 'register') {
                html = renderRegisterPage();
            } else if (currentPage === 'login') {
                html = renderLoginPage();
            } else if (currentPage === 'dashboard') {
                html = await renderDashboard();
            }
            
            document.getElementById('app').innerHTML = html;
        }

        async function init() {
            const sessionResult = await supabase.auth.getSession();
            
            if (sessionResult.data.session) {
                currentUser = sessionResult.data.session.user;
                currentPage = 'dashboard';
            }
            
            await render();
        }

        init();
    </script>
</body>
</html>
