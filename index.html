<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Vendas - BrisaChip</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            margin-bottom: 20px;
        }

        .login-card {
            max-width: 400px;
            margin: 0 auto 20px auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
        }

        .btn-plan {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            margin: 5px;
            padding: 10px 20px;
            width: auto;
            display: inline-block;
        }

        .btn-plan.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .hidden {
            display: none;
        }

        .sales-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .date-range {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        .date-range .form-group {
            flex: 1;
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .sales-table th, .sales-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .sales-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .status-pendente {
            background-color: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .status-efetivada {
            background-color: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .copyright {
            text-align: center;
            margin-top: 20px;
            color: white;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .plan-selection {
            margin-bottom: 20px;
        }

        .plan-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .iccid-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .date-range {
                flex-direction: column;
            }
            
            .plan-buttons {
                flex-direction: column;
            }
            
            .btn-plan {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Vendas BrisaChip</h1>
            <p>Gerencie suas vendas de forma eficiente</p>
        </div>

        <!-- Tela de Login -->
        <div id="loginScreen" class="card login-card">
            <h2 style="text-align: center; margin-bottom: 20px; color: #667eea;">Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Usuário:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
            </form>
            <button type="button" class="btn btn-secondary" onclick="showRegisterScreen()">Cadastrar</button>
            
            <div class="copyright">
                Desenvolvido por Igor Borges.
            </div>
        </div>

        <!-- Tela de Cadastro -->
        <div id="registerScreen" class="card login-card hidden">
            <h2 style="text-align: center; margin-bottom: 20px; color: #667eea;">Cadastro</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regUsername">Usuário:</label>
                    <input type="text" id="regUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email:</label>
                    <input type="email" id="regEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Senha:</label>
                    <input type="password" id="regPassword" name="password" required>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Confirmar Senha:</label>
                    <input type="password" id="regConfirmPassword" name="confirmPassword" required>
                </div>
                
                <div class="plan-selection">
                    <label>Selecione o Plano:</label>
                    <div class="plan-buttons">
                        <button type="button" class="btn-plan" data-plan="20GB" data-price="29.99">20GB por R$ 29,99</button>
                        <button type="button" class="btn-plan" data-plan="30GB" data-price="39.99">30GB por R$ 39,99</button>
                        <button type="button" class="btn-plan" data-plan="100GB" data-price="49.99">100GB por R$ 49,99</button>
                    </div>
                    <input type="hidden" id="selectedPlan" name="selectedPlan" required>
                    <input type="hidden" id="selectedPrice" name="selectedPrice" required>
                </div>

                <button type="submit" class="btn">Cadastrar</button>
                <button type="button" class="btn btn-secondary" onclick="showLoginScreen()">Voltar ao Login</button>
            </form>
            
            <div class="copyright">
                Desenvolvido por Igor Borges.
            </div>
        </div>

        <!-- Tela Principal -->
        <div id="mainScreen" class="hidden">
            <div class="sales-grid">
                <!-- Cadastro de Venda -->
                <div class="card">
                    <h3 style="color: #667eea; margin-bottom: 20px;">Cadastrar Venda</h3>
                    <form id="saleForm">
                        <div class="form-group">
                            <label for="clientName">Nome do Cliente:</label>
                            <input type="text" id="clientName" name="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Telefone:</label>
                            <input type="tel" id="clientPhone" name="clientPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="iccid">ICCID (últimos 8 dígitos):</label>
                            <input type="text" id="iccid" name="iccid" maxlength="8" minlength="8" required>
                            <div class="iccid-info">Obrigatório inserir exatamente 8 dígitos</div>
                        </div>
                        <div class="form-group">
                            <label for="saleType">Tipo de Venda:</label>
                            <select id="saleType" name="saleType" required>
                                <option value="">Selecione...</option>
                                <option value="Fibra">Fibra</option>
                                <option value="Combo">Combo</option>
                                <option value="Móvel">Móvel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="saleValue">Valor da Venda:</label>
                            <input type="number" id="saleValue" name="saleValue" step="0.01" required>
                        </div>
                        <button type="submit" class="btn">Cadastrar Venda</button>
                    </form>
                </div>

                <!-- Filtros -->
                <div class="card">
                    <h3 style="color: #667eea; margin-bottom: 20px;">Filtros</h3>
                    <div class="form-group">
                        <label for="filterPeriod">Período:</label>
                        <select id="filterPeriod" name="filterPeriod" onchange="toggleCustomPeriod()">
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month">Este Mês</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div id="customPeriod" class="date-range hidden">
                        <div class="form-group">
                            <label for="dateFrom">De:</label>
                            <input type="date" id="dateFrom" name="dateFrom">
                        </div>
                        <div class="form-group">
                            <label for="dateTo">Até:</label>
                            <input type="date" id="dateTo" name="dateTo">
                        </div>
                        <button type="button" class="btn" onclick="applyCustomFilter()">Aplicar Filtro</button>
                    </div>
                    <div class="form-group">
                        <label for="filterType">Tipo:</label>
                        <select id="filterType" name="filterType" onchange="filterSales()">
                            <option value="">Todos</option>
                            <option value="Fibra">Fibra</option>
                            <option value="Combo">Combo</option>
                            <option value="Móvel">Móvel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterStatus">Status:</label>
                        <select id="filterStatus" name="filterStatus" onchange="filterSales()">
                            <option value="">Todos</option>
                            <option value="Pendente">Pendente</option>
                            <option value="Efetivada">Efetivada</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabela de Vendas -->
            <div class="card">
                <h3 style="color: #667eea; margin-bottom: 20px;">Vendas Cadastradas</h3>
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Telefone</th>
                            <th>ICCID</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <!-- Vendas serão inseridas aqui -->
                    </tbody>
                </table>
            </div>

            <div class="copyright">
                Desenvolvido por Igor Borges.
            </div>
        </div>
    </div>

    <script>
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let currentUser = null;

        // Gerenciamento de telas
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showRegisterScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showMainScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            loadSales();
        }

        // Seleção de planos no cadastro
        document.querySelectorAll('.btn-plan').forEach(button => {
            button.addEventListener('click', function() {
                // Remove seleção anterior
                document.querySelectorAll('.btn-plan').forEach(btn => btn.classList.remove('selected'));
                
                // Adiciona seleção atual
                this.classList.add('selected');
                
                // Armazena valores selecionados
                document.getElementById('selectedPlan').value = this.dataset.plan;
                document.getElementById('selectedPrice').value = this.dataset.price;
            });
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Simulação de login (em produção, validar com servidor)
            if (username && password) {
                currentUser = username;
                showMainScreen();
            } else {
                alert('Usuário ou senha inválidos!');
            }
        });

        // Cadastro
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            const selectedPlan = formData.get('selectedPlan');
            
            if (password !== confirmPassword) {
                alert('As senhas não coincidem!');
                return;
            }
            
            if (!selectedPlan) {
                alert('Por favor, selecione um plano!');
                return;
            }

            // Preparar dados para webhook
            const webhookData = {
                username: formData.get('username'),
                email: formData.get('email'),
                plan: selectedPlan,
                price: formData.get('selectedPrice'),
                timestamp: new Date().toISOString()
            };

            try {
                // Chamar webhook
                const response = await fetch('https://n8n-n8n.rthuab.easypanel.host/webhook/fluxo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(webhookData)
                });

                if (response.ok) {
                    alert('Cadastro realizado com sucesso!');
                    showLoginScreen();
                    document.getElementById('registerForm').reset();
                    // Remove seleção de plano
                    document.querySelectorAll('.btn-plan').forEach(btn => btn.classList.remove('selected'));
                } else {
                    throw new Error('Erro no servidor');
                }
            } catch (error) {
                console.error('Erro ao cadastrar:', error);
                alert('Erro ao realizar cadastro. Tente novamente.');
            }
        });

        // Cadastro de venda
        document.getElementById('saleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const iccid = formData.get('iccid');
            
            // Validar ICCID (exatamente 8 dígitos)
            if (!/^\d{8}$/.test(iccid)) {
                alert('ICCID deve conter exatamente 8 dígitos numéricos!');
                return;
            }
            
            const saleType = formData.get('saleType');
            let status = 'Efetivada';
            
            // Para Fibra e Combo, status inicial é Pendente
            if (saleType === 'Fibra' || saleType === 'Combo') {
                status = 'Pendente';
            }

            const sale = {
                id: Date.now(),
                date: new Date().toLocaleDateString('pt-BR'),
                clientName: formData.get('clientName'),
                clientPhone: formData.get('clientPhone'),
                iccid: iccid,
                saleType: saleType,
                saleValue: parseFloat(formData.get('saleValue')),
                status: status,
                user: currentUser
            };

            sales.push(sale);
            localStorage.setItem('sales', JSON.stringify(sales));
            
            this.reset();
            loadSales();
            alert('Venda cadastrada com sucesso!');
        });

        // Carregar vendas na tabela
        function loadSales() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';

            sales.forEach(sale => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.clientName}</td>
                    <td>${sale.clientPhone}</td>
                    <td>${sale.iccid}</td>
                    <td>${sale.saleType}</td>
                    <td>R$ ${sale.saleValue.toFixed(2)}</td>
                    <td><span class="status-${sale.status.toLowerCase()}">${sale.status}</span></td>
                    <td>
                        ${sale.status === 'Pendente' ? 
                            `<button onclick="changeStatus(${sale.id}, 'Efetivada')" class="btn" style="padding: 5px 10px; font-size: 12px;">Efetivar</button>` : 
                            ''}
                        <button onclick="deleteSale(${sale.id})" class="btn" style="padding: 5px 10px; font-size: 12px; background: #dc3545;">Excluir</button>
                    </td>
                `;
            });
        }

        // Alterar status da venda
        function changeStatus(saleId, newStatus) {
            const saleIndex = sales.findIndex(sale => sale.id === saleId);
            if (saleIndex !== -1) {
                sales[saleIndex].status = newStatus;
                localStorage.setItem('sales', JSON.stringify(sales));
                loadSales();
            }
        }

        // Excluir venda
        function deleteSale(saleId) {
            if (confirm('Tem certeza que deseja excluir esta venda?')) {
                sales = sales.filter(sale => sale.id !== saleId);
                localStorage.setItem('sales', JSON.stringify(sales));
                loadSales();
            }
        }

        // Filtros
        function toggleCustomPeriod() {
            const period = document.getElementById('filterPeriod').value;
            const customPeriod = document.getElementById('customPeriod');
            
            if (period === 'custom') {
                customPeriod.classList.remove('hidden');
            } else {
                customPeriod.classList.add('hidden');
                filterSales();
            }
        }

        function applyCustomFilter() {
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            if (!dateFrom || !dateTo) {
                alert('Por favor, selecione ambas as datas!');
                return;
            }
            
            filterSales();
        }

        function filterSales() {
            // Implementar lógica de filtros aqui
            loadSales(); // Por enquanto, apenas recarrega todas as vendas
        }

        // Validação de ICCID em tempo real
        document.getElementById('iccid').addEventListener('input', function() {
            const value = this.value.replace(/\D/g, ''); // Remove não-dígitos
            this.value = value;
            
            if (value.length !== 8) {
                this.style.borderColor = '#dc3545';
            } else {
                this.style.borderColor = '#28a745';
            }
        });

        // Inicializar na tela de login
        showLoginScreen();
    </script>
</body>
</html>
